\chapter{Repairing and Generating Dockerfiles (title is WIP)} \label{chap:sota}

This section covers existing literature and tools that are related to several components of the Dockerfile development experience and Docker in general. Section \ref{sec:background} goes over the background that is required to understand this paper. Section \ref{sec:speeding_up_docker_builds} goes over ways to accelerate Docker builds. Section \ref{sec:dockerfile_generation} goes over works that cover the generation of Dockerfiles. Section \ref{sec:dockerfile_smells} covers smells in Dockerfiles. Section \ref{sec:dockerfile_good_practices} talks about good practices that should be taken into account when writing Dockerfiles. Section \ref{sec:dockerfile_security} tackles the topic of security in Dockerfiles. Section \ref{sec:dockerfile_repair} covers the detection and repair of faults in Dockerfiles. Section \ref{sec:dockerfile_bloat} covers the detection and removal of bloat in Dockerfiles. Section \ref{sec:dockerfile_testing} is about testing Dockerfiles. Section \ref{sec:general_discussion} concludes with a general discussion.

\section{Background} \label{sec:background}
...
\section{Speeding up Docker builds} \label{sec:speeding_up_docker_builds}

Building Docker images can take a considerable amount of time, especially when a large amount of files have to be fetched from the internet ~\citep{harterSlackerFastDistribution}. Therefore, we looked for ways to reduce the amount of time consumed by this activity. Our findings are summarized in Table \ref{tab:works_speeding_up}.

\begin{table}[H]
    \centering
    \begin{tabular}{|p{0.25\textwidth}|c|p{0.2\textwidth}|p{0.2\textwidth}|}
        \hline \textbf{Name} & \textbf{Speedup} & \textbf{Limitations} & \textbf{Implementation Complexity} \\
        \hline A Code Injection Method for Rapid Docker Image Building \cite{wangCodeInjectionMethod2019} & Up to 100000x faster & Can only be used with interpreted languages, limited to modifications in the source code & High \\
        \hline FastBuild: Accelerating Docker Image Building for Efficient Development and Deployment of Container \cite{huangFastBuildAcceleratingDocker2019} & Up to 10x faster & Limited to network activity & High \\
        \hline Slacker: Fast Distribution with Lazy Docker Containers \cite{harterSlackerFastDistribution} & Up to 20x faster & Limited to network activity & High \\
        \hline Docker Buildx \cite{DockerBuildx2022} & Unknown & Unknown & Low-Medium \\
        \hline
    \end{tabular} 
    \caption{Works about speeding up Docker builds}
    \label{tab:works_speeding_up}
\end{table}

Wang et al. \cite{wangCodeInjectionMethod2019} propose a technique that bypasses typical building procedures by injecting the code modifications directly in an image. The results are very promising. However, due to the nature of approach, it can only be used with interpreted languages and will not accelerate builds related to modifications in development artifacts that are not source code.

Huang et al. \cite{huangFastBuildAcceleratingDocker2019} and Harter et al. \cite{harterSlackerFastDistribution} address the network bottleneck in different ways. The former caches files locally and intercepts Docker's network requests in order to serve files that have been stored locally. The latter proposes a new storage driver that lazily fetches files from the network. Both show promising results and do not address other inefficiencies in the Docker building process.

The works described so far interfere with the normal Docker build procedures, making them harder to implement. Another solution is offered by the Docker development team, Buildx \cite{DockerBuildx2022}. Buildx makes use of a newer backend, BuildKit \cite{BuildKit2022}, which brings many features that can potentially accelerate docker builds. However, to our knowledge, an apples to apples time comparison has not been made. Implementing this in Dockerlive wouldn't be very hard but because the output of the buildx command is different, some modifications would still be required.

\section{Dockerfile Generation} \label{sec:dockerfile_generation}

Writing Dockerfiles is not an easy process \cite{reisDevelopingDockerDockerCompose2022}. Therefore, having a way to generate a Dockerfile for a given project can be very useful. In this section, we looked for works that showcased ways to accomplish this. Our findings are summarized in Table \ref{tab:works_dockerfile_generation}.

\begin{table}[H]
    \centering
    \begin{tabular}{|p{0.25\textwidth}|p{0.2\textwidth}|p{0.2\textwidth}|p{0.2\textwidth}|}
        \hline \textbf{Name} & \textbf{Successful generation rate} & \textbf{Limitations} & \textbf{Implementation Complexity} \\
        \hline Applying Model-Driven Engineering to Stimulate the Adoption of DevOps Processes in Small and Medium-Sized Development Organizations \cite{sorgallaApplyingModelDrivenEngineering2021} & Unknown & An Open API Spec is required & Medium \\
        \hline Burner: Recipe Automatic Generation for HPC Container Based on Domain Knowledge Graph \cite{zhongBurnerRecipeAutomatic2022} & Up to 80\% & A vast knowledge graph is required, focused on Singularity & High \\
        \hline Container-Based Module Isolation for Cloud Services \cite{kehrerContainerBasedModuleIsolation2019} & Unknown & Requires the use of templates to generate the files & Medium-High \\
        \hline DockerGen: A Knowledge Graph based Approach for Software Containerization \cite{yeDockerGenKnowledgeGraph2021} & Up to 73\% & A vast knowledge graph is required & High \\
        \hline DockerizeMe: Automatic Inference of Environment Dependencies for Python Code Snippets \cite{hortonDockerizeMeAutomaticInference2019} & Up to 30\% & Limited to Python, requires a knowledge base & High \\
        \hline ExploitWP2Docker: a Platform for Automating the Generation of Vulnerable WordPress Environments for Cyber Ranges \cite{caturanoExploitWP2DockerPlatformAutomating2022} & Up to 39\% & Limited to security testing scenarios & Low-Medium \\
        \hline MAKING CONTAINERS EASIER WITH HPC CONTAINER MAKER \cite{mcmillanMAKINGCONTAINERSEASIER} & Unknown & Requires Python code to generate the files & Medium-High \\
        \hline
    \end{tabular} 
    \caption{Works about generating Dockerfiles}
    \label{tab:works_dockerfile_generation}
\end{table}

Zhong et al. \cite{zhongBurnerRecipeAutomatic2022}, Ye et al. \cite{yeDockerGenKnowledgeGraph2021} and Horton et at. \cite{hortonDockerizeMeAutomaticInference2019} present solutions that require pre-existing knowledge bases in order to generate the files, making them hard to implement in a project like ours, which is not completely focused on file generation. DockerizeMe is also limited to Python environments, while Burner is more focused on Singularity \cite{Apptainer}, a containerization tool similar to Docker but focused on HPC (High Performance Computing).

Caturano et al. \cite{caturanoExploitWP2DockerPlatformAutomating2022} propose a tool that uses Docker to generate security testing environments from exploit descriptions. Sorgalla et al. \cite{sorgallaApplyingModelDrivenEngineering2021}'s work can generate Dockerfiles from models, which are generated from Open API Specifications (like Swagger \cite{Swagger}). Kehrer et al. \cite{kehrerContainerBasedModuleIsolation2019} use Apache FreeMarker \cite{ApacheFreeMarker} to generate Dockerfiles from templates. McMillan et al. \cite{mcmillanMAKINGCONTAINERSEASIER} offer a tool that allows developer to use Python code to define the information required to generate Dockerfiles.

All these works show varying degrees of success and some of them are not even focused on the Dockerfile generation aspect.

\section{Dockerfile Smells} \label{sec:dockerfile_smells}

Smells are commonly found in Dockerfiles \cite{wuCharacterizingOccurrenceDockerfile2020}, making it important to create ways of detecting and, if possible, remove them. This section covers works related to this. Our findings are summarized in Table \ref{tab:works_dockerfile_smells}.

\begin{table}[H]
    \centering
    \begin{tabular}{|p{0.25\textwidth}|c|p{0.2\textwidth}|p{0.2\textwidth}|}
        \hline \textbf{Name} & \textbf{Smells} & \textbf{Findings} & \textbf{Possible repair implementation complexity} \\
        \hline An Empirical Case Study on the Temporary File Smell in Dockerfiles \cite{luEmpiricalCaseStudy2019} & Temporary File & The smell is quite common and can be divided into 4 different types, 3 of which can be detected through the proposed methods & Medium \\
        \hline An empirical study on self-admitted technical debt in Dockerfiles \cite{azumaEmpiricalStudySelfadmitted2022} & SATD & Shows that a type of smell appears in Dockerfiles and can be divided into several classes and subclasses & High \\
        \hline Characterizing the Occurrence of Dockerfile Smells in Open-Source Software: An Empirical Study \cite{wuCharacterizingOccurrenceDockerfile2020} & All & Smells appear commonly in projects and the frequency with which they appear varies according to several metrics & High \\
        \hline Dockerfile TF Smell Detection Based on Dynamic and Static Analysis Methods \cite{xuDockerfileTFSmell2019} & Temporary File & It's possible to detect the smell with high accuracy using static and dynamic analysis & Medium \\
        \hline Refactorings and Technical Debt for Docker Projects \cite{ksontiniRefactoringsTechnicalDebt} & All & Docker related refactorings happen for a variety of reasons & High \\
        \hline
    \end{tabular} 
    \caption{Works about Dockerfile smells}
    \label{tab:works_dockerfile_smells}
\end{table}

Lu et al. \cite{luEmpiricalCaseStudy2019} and Xu et al. \cite{xuDockerfileTFSmell2019} have focused on the temporary file smell and propose ways to detect this smell. A repair to deal with this smell could be implemented using the information provided by these works.

Azuma et al. \cite{azumaEmpiricalStudySelfadmitted2022} focus on a variation of smells they call SATD (self-admitted technical debt) which can be detected in comments written in the Dockerfiles. Due to the nature of these SATDs, implementing repairs to eliminate them could be very complicated.

Wu et al. \cite{wuCharacterizingOccurrenceDockerfile2020} analyzed a large amount of open-source projects and found that Dockerfile smells are very common and their frequency changes according to several factors like the programming language used by the project or the project's age. Due to the variety of smells covered by this study implementing repairs to deal with all of them would be difficult. 

Ksontini et at. \cite{ksontiniRefactoringsTechnicalDebt} focused on refactorings (a concept which is closely tied to smells) and found that developers' main motivations for performing refactorings were tied to maintainability and image size among others. Implementing some of these refactorings as repairs would be useful, although implementing all of them would be challenging.

\section{Dockerfile Good Practices} \label{sec:dockerfile_good_practices}
\section{Dockerfile Security} \label{sec:dockerfile_security}
\section{Dockerfile Repair} \label{sec:dockerfile_repair}
\section{Dockerfile Bloat} \label{sec:dockerfile_bloat}
\section{Dockerfile Testing} \label{sec:dockerfile_testing}




\section{General Discussion} \label{sec:general_discussion}
